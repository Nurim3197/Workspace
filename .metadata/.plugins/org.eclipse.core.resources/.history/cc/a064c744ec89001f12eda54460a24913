<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ktdsuniversity.edu.hello_spring.bbs.dao.replyDao">
	
	
	<!-- JOIN해서 가져올테니까 이렇게 함 -->
	<resultMap type="com.ktdsuniversity.edu.hello_spring.bbs.vo.ReplyVO"
				id="replyVOMap"
				autoMapping="true">
		<id column="REPLY_ID" property="replyID"/>
		<association property="memberVO"
						javaType="com.ktdsuniversity.edu.hello_spring.member.vo">
			<id column="REPLY_ID" property="replyId" />
			<result column="NAME" property="name" />
		</association>
	 </resultMap>
	 <select id="getAllReplies"
	 		parameterType="_int"
	 		resultMap="replyVOMap">
	 		<!-- 상단에 이쓰는 resultMap에서 replyVO에 맞는 값 자동으로 Mapping해준다. -->
	 		SELECT LEVEL 
			     , R.REPLY_ID
			     , R.RECOMMEND_CNT
			     , R.PARENT_REPLY_ID
			     , R.MDFY_DT
			     , R.EMAIL
			     , R.CRT_DT
			     , R.CONTENT
			     , R.BOARD_ID
			     , M.NAME
			  FROM REPLIES R
			 INNER JOIN BOARD b
			    ON R.BOARD_ID =B.ID
			 INNER JOIN MEMBERS m 
			    ON R.EMAIL = M.EMAIL
			 START WITH R.PARENT_REPLY_ID = 0
			   AND R.BOARD_ID = #{_parameter}
			CONNET BY PRIOR R.REPLY_ID = R.PARENT_REPLY_ID
	 </select>
	 
	 <select id="getOneReply"
	 			parameterType="_int"
	 			resultType="replyVOMap">
	 	SELECT R.REPLY_ID
		     , R.RECOMMEND_CNT
		     , R.PARENT_REPLY_ID
		     , R.MDFY_DT
		     , R.EMAIL
		     , R.CRT_DT
		     , R.CONTENT
		     , R.BOARD_ID
		     , M.NAME
		  FROM REPLIES r
		 INNER JOIN BOARD b
		    ON R.BOARD_ID = B.ID
		 INNER JOIN MEMBERS m 
		    ON R.EMAIL = M.EMAIL
		 WHERE R.REPLY_ID = {_parameter}
	 </select>
	 <insert id="createNewReply"
	 			parameterType=""
	 			resultType="">
	 
	 </insert>
</mapper>